<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Giảm kích thước Docker image cho ứng dụng Ruby on Rails</title><meta name="robots" content="follow, index"/><meta name="description" content="Việc giảm dung lượng Docker image tuân theo nguyên tắc cơ bản nhất chính là loại bỏ các thành phần không cần thiết trong Docker image"/><meta property="og:url" content="https://fossil-engineering.github.io/blog/docker-size"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Fossil Engineering"/><meta property="og:description" content="Việc giảm dung lượng Docker image tuân theo nguyên tắc cơ bản nhất chính là loại bỏ các thành phần không cần thiết trong Docker image"/><meta property="og:title" content="Giảm kích thước Docker image cho ứng dụng Ruby on Rails"/><meta property="og:image" content="https://fossil-engineering.github.io/static/img/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content=""/><meta name="twitter:title" content="Giảm kích thước Docker image cho ứng dụng Ruby on Rails"/><meta name="twitter:description" content="Việc giảm dung lượng Docker image tuân theo nguyên tắc cơ bản nhất chính là loại bỏ các thành phần không cần thiết trong Docker image"/><meta name="twitter:image" content="https://fossil-engineering.github.io/static/img/twitter-card.png"/><meta property="article:published_time" content="2020-01-04T00:00:00.000Z"/><link rel="canonical" href="https://fossil-engineering.github.io/blog/docker-size"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fossil-engineering.github.io/blog/docker-size"
  },
  "headline": "Giảm kích thước Docker image cho ứng dụng Ruby on Rails",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://fossil-engineering.github.io/static/img/twitter-card.png"
    }
  ],
  "datePublished": "2020-01-04T00:00:00.000Z",
  "dateModified": "2020-01-04T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Loi Nguyen"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fossil-engineering.github.ioundefined"
    }
  },
  "description": "Việc giảm dung lượng Docker image tuân theo nguyên tắc cơ bản nhất chính là loại bỏ các thành phần không cần thiết trong Docker image"
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="180x180" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#2b5797"/><meta name="theme-color" content="#ffffff"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preconnect" href="https://rsms.me" crossorigin="anonymous"/><link rel="stylesheet" href="https://rsms.me/inter/inter.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/b693e7f131ffbefb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b693e7f131ffbefb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9133012e245d1800.js" defer=""></script><script src="/_next/static/chunks/main-d1a4c4948e919875.js" defer=""></script><script src="/_next/static/chunks/pages/_app-59782f638fb577fb.js" defer=""></script><script src="/_next/static/chunks/873-f5f0ae1404cf2469.js" defer=""></script><script src="/_next/static/chunks/410-c355667be495050f.js" defer=""></script><script src="/_next/static/chunks/620-b3ef26e88761d47d.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-f303eca3eb213a66.js" defer=""></script><script src="/_next/static/bYvShaFajK7r1Z24hTcnv/_buildManifest.js" defer=""></script><script src="/_next/static/bYvShaFajK7r1Z24hTcnv/_ssgManifest.js" defer=""></script><script src="/_next/static/bYvShaFajK7r1Z24hTcnv/_middlewareManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v12/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="Tailwind CSS Blog" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="132.393" height="25.507" xml:space="preserve"><path d="M89.751 10.925c-4.768-1.529-6.842-2.877-6.486-5.096.342-2.201 2.729-2.07 5.047-1.89 2.291.192 4.158.701 5.52 1.148.025.018.105-.004.121-.082.121-.806.559-2.943.678-3.675.018-.091-.068-.136-.113-.147C91.729.428 89.182-.052 86.137.004c-5.703.099-8.354 2.396-8.678 7.192-.191 2.799 1.748 5.893 5.777 7.227 4.029 1.334 6.904 2.087 6.486 4.57-.369 2.104-2.85 2.342-5.539 2.187-2.355-.144-4.348-.705-5.834-1.156-.107-.032-.172.021-.197.119-.111.864-.424 3.071-.531 3.849-.004.104.084.188.129.198 1.859.445 5.15 1.07 9.197 1.07 5.473 0 8.312-2.347 8.631-6.841.247-3.487-1.395-6.067-5.827-7.494zM65.068 10.925c-4.771-1.529-6.839-2.877-6.485-5.096.344-2.201 2.729-2.07 5.04-1.89 2.292.192 4.16.701 5.517 1.148.039.018.096-.004.113-.082.139-.806.566-2.943.691-3.675a.139.139 0 0 0-.111-.147C67.04.428 64.494-.052 61.454.004 55.75.103 53.101 2.4 52.766 7.196c-.188 2.8 1.753 5.896 5.774 7.23 4.024 1.334 6.898 2.086 6.494 4.567-.367 2.105-2.846 2.342-5.539 2.188-2.366-.142-4.346-.707-5.842-1.156-.096-.032-.168.021-.188.117-.11.867-.425 3.073-.53 3.853-.003.102.075.188.124.196a40.142 40.142 0 0 0 9.191 1.07c5.478 0 8.31-2.347 8.632-6.843.256-3.486-1.387-6.066-5.814-7.493zM17.998.555H1.468a.157.157 0 0 0-.162.155v23.971c0 .088.064.16.162.16H6.96a.156.156 0 0 0 .155-.16V15.71c0-.082.072-.16.162-.16h9.525c.092 0 .164-.064.164-.15v-3.708a.165.165 0 0 0-.164-.165H7.277a.16.16 0 0 1-.162-.162V4.74c0-.085.072-.16.162-.16h10.861a.154.154 0 0 0 .156-.157L18.168.711c-.012-.08-.09-.156-.17-.156zM109.023.537h-5.666c-.1 0-.16.068-.16.156v23.991c0 .084.061.149.16.149h5.666c.09 0 .154-.065.154-.149V.693a.152.152 0 0 0-.154-.156zM133.536 20.742h-9.395a.16.16 0 0 1-.158-.156L123.981.732c0-.099-.066-.161-.16-.161h-5.658a.157.157 0 0 0-.162.161v23.951c0 .084.076.147.162.147h15.186c.088 0 .164-.063.168-.147l.182-3.772c-.002-.098-.065-.169-.163-.169zM35.363.026c-7.436 0-11.493 4.878-11.493 12.743 0 7.857 4.059 12.738 11.493 12.738 7.433 0 11.487-4.881 11.487-12.738C46.85 4.787 42.901.026 35.363.026zm0 21.462c-5.05 0-5.749-4.193-5.749-8.719 0-4.52.699-8.714 5.749-8.714 5.044 0 5.738 4.192 5.738 8.714 0 4.525-.694 8.719-5.738 8.719z"></path></svg></div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 py-1 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2020-01-04T00:00:00.000Z">Saturday, January 4, 2020</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Giảm kích thước Docker image cho ứng dụng Ruby on Rails</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="w-10 h-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://avatars.githubusercontent.com/u/9493402?v=4?imwidth=48 1x, https://avatars.githubusercontent.com/u/9493402?v=4?imwidth=96 2x" src="https://avatars.githubusercontent.com/u/9493402?v=4?imwidth=96" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="w-10 h-10 rounded-full" loading="lazy"/></noscript></span><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100"><a href="/author/loi">Loi Nguyen</a></dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://github.com/ntloi95" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@ntloi95</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><p><img src="/media/2020/docker.png" alt="Docker"/></p>
<p>Việc giảm dung lượng Docker image tuân theo nguyên tắc cơ bản nhất chính là loại bỏ các thành phần không cần thiết trong Docker image.
Điều này có thể đạt được dựa vào các thủ thuật sau:</p>
<ul>
<li>Dùng image base nhỏ: alpine, slim.</li>
<li>Multiple stages build.</li>
<li>Xóa các file ko cần thiết</li>
<li>Dùng Dockerignore.</li>
<li>Giảm số lượng layer.</li>
</ul>
<p>Để đọc bài này các bạn cần?</p>
<ul>
<li>Biết Docker là gì và dùng để làm gì.</li>
<li>Biết và đã từng viết Dockerfile, build Docker images.</li>
<li>Biết và từng làm việc với Ruby on Rails.</li>
</ul>
<h2 id="vấn-đề-của-docker-images-quá-nặng"><a href="#vấn-đề-của-docker-images-quá-nặng" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Vấn đề của Docker images quá nặng</h2>
<h3 id="câu-chuyện-của-mình"><a href="#câu-chuyện-của-mình" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Câu chuyện của mình</h3>
<p>Thời gian trước, mình có nhận một project, server đặt ở Trung Quốc. Mạng mẽo Mẫu Quốc như mọi người đều biết, rất chậm khi đi qua đường truyền quốc tế, đến cả Google, Facebook đều hầu như không sử dụng được. Code và CI server (CI server là server để thực hiện quá trình build Docker image từ code) thì đặt ở Mỹ (vì đơn giản bọn mình dùng Cloud provider, Git remote server ở đấy). Push một Docker image 400 MB qua Trung Quốc trung bình mất hết 40 phút. Thỉnh thoảng thì hơn 1 giờ. Có khi đang push giữa chừng thì bị disconnect luôn.</p>
<p>Docker image quá lớn sẽ:</p>
<ul>
<li>Tốn thời gian upload.</li>
<li>Tốn băng thông mạng. Cái này nguy hiểm nếu bạn sử dụng đường mạng riêng, trả tiền theo lưu lượng.</li>
<li>Tốn tiền lưu trữ image trên repository.</li>
<li>Ứng dụng trở nên cồng kềnh, thời gian pull image sẽ lâu.</li>
</ul>
<p>Nói chung là vừa tốn tiền vừa ảnh hưởng tới tốc độ release sản phẩm. Các bạn thử nghĩ xem, nếu các bạn chỉ muốn đổi chỗ 1 button trên qua phải 1 pixel, mà bạn phải đợi 1 giờ để đưa cho khách hàng xem. :) Mà làm phần mềm thì requirement thay đổi liên tục. Nên mình quyết định tìm cách giảm dung lượng Docker image xuống.</p>
<p>Đây là bài viết hướng dẫn kỹ thuật đầu tiên của mình, cũng chỉ là múa rìu qua mắt thợ nhưng hy vọng nó sẽ giúp cho các bạn fresher, junior giải quyết được vấn đề về Docker image size quá lớn.</p>
<h3 id="ví-dụ-minh-họa"><a href="#ví-dụ-minh-họa" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Ví dụ minh họa</h3>
<p>Để cho dễ hình dung, mình sẽ lấy một Dockerfile điển hình của Ruby on Rails để làm ví dụ, có thể sẽ thiếu và thừa một chút xíu.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line"># Kế thừa build base là image của ruby:2.5.3 phiên bản đầy đủ, official trên Docker Hub.
</span><span class="code-line">FROM ruby:2.5.3
</span><span class="code-line">
</span><span class="code-line"># Chạy hai lệnh apt-get (quản lý package của Ubuntu) để cài nodejs (cần trong quá trình build assets js, css của web), và build-base (build rubygems)
</span><span class="code-line">RUN apt-get update
</span><span class="code-line">RUN apt-get install -y nodejs build-base
</span><span class="code-line">
</span><span class="code-line"># Thiết lập một số biến môi trường cho Docker container.
</span><span class="code-line">ENV RAILS_ENV ${RAILS_ENV}
</span><span class="code-line">ENV APP_HOME /code
</span><span class="code-line">
</span><span class="code-line"># Tạo thư mục WORKDIR lấy từ ENV APP_HOME, mặc định ở trên là /code
</span><span class="code-line">RUN mkdir $APP_HOME
</span><span class="code-line">WORKDIR $APP_HOME
</span><span class="code-line">
</span><span class="code-line"># Get dependencies của Rails
</span><span class="code-line">ADD Gemfile* $APP_HOME/
</span><span class="code-line">RUN bundle install - jobs 4
</span><span class="code-line">
</span><span class="code-line"># Copy hết thư mục hiện tại vào thư mục WORKDIR
</span><span class="code-line">ADD . $APP_HOME
</span><span class="code-line">
</span><span class="code-line"># Docker container mở port 3000
</span><span class="code-line">EXPOSE 3000
</span><span class="code-line">
</span><span class="code-line"># Command run app
</span><span class="code-line">CMD bundle exec puma -C config/puma.rb
</span></code></pre></div>
<h2 id="cách-giảm-dung-lượng-docker-image"><a href="#cách-giảm-dung-lượng-docker-image" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Cách giảm dung lượng Docker image</h2>
<h3 id="kiểm-tra-dung-lượng-docker-image"><a href="#kiểm-tra-dung-lượng-docker-image" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Kiểm tra dung lượng Docker image</h3>
<p>Mình build Dockerfile ở trên, lệnh list docker images sẽ cho ta thấy dung lượng của image ở cột cuối cùng.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">╰─ docker images | head -2
</span><span class="code-line">REPOSITORY       TAG        IMAGE ID       CREATED              SIZE
</span><span class="code-line">ntloi            latest     2343d383ebca  About ...ago        1.12GB
</span></code></pre></div>
<p>What? 1.12 GB =))</p>
<p>Để hiểu rõ tại sao lại to như vậy ta dùng lệnh docker history. (Thứ tự các câu lệnh sẽ bị ngược so với Docker file, do các layer stack lên nhau).</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">╰─ docker history ntloi:latest
</span><span class="code-line">CREATED BY                                      SIZE
</span><span class="code-line">/bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;bund…   0B
</span><span class="code-line">/bin/sh -c #(nop)  EXPOSE 3000                  0B
</span><span class="code-line">/bin/sh -c #(nop) ADD dir:0c93aceee1fd93e794…   52.3MB
</span><span class="code-line">/bin/sh -c bundle install --jobs 4              158MB
</span><span class="code-line">...
</span><span class="code-line">/bin/sh -c apt-get install -y nodejs --no-in…   16.5MB
</span><span class="code-line">/bin/sh -c apt-get update                       16.4MB
</span><span class="code-line">...
</span><span class="code-line">/bin/sh -c set -ex   &amp;&amp; buildDeps=&#x27;   bison …   37.7MB
</span><span class="code-line">...
</span><span class="code-line">/bin/sh -c mkdir -p /usr/local/etc  &amp;&amp; {   e…   45B
</span><span class="code-line">/bin/sh -c set -ex;  apt-get update;  apt-ge…   562MB
</span><span class="code-line">/bin/sh -c apt-get update &amp;&amp; apt-get install…   142MB
</span><span class="code-line">/bin/sh -c set -ex;  if ! command -v gpg &gt; /…   7.81MB
</span><span class="code-line">/bin/sh -c apt-get update &amp;&amp; apt-get install…   23.2MB
</span><span class="code-line">...
</span><span class="code-line">/bin/sh -c #(nop) ADD file:e4bdc12117ee95eaa…   101MB
</span></code></pre></div>
<h3 id="dùng-alpine-image"><a href="#dùng-alpine-image" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Dùng alpine image</h3>
<p>Rõ ràng là các layer in đậm không phải mình tạo ra. Nó là layer của câu lệnh đầu tiên trong Dockerfile: <code>FROM ruby:2.5.3</code> (Gần 900 MB).</p>
<p>Giải quyết vấn đề này ta có thể dùng các images ruby khác nhẹ hơn, nhẹ nhất ở đây là nhóm alpine. Có thể bạn chưa biết alpine là bản phân phối linux nhẹ bậc nhất. Và ruby 2.5.3 cài trên alpine cỡ ~ 22 MB. Nhưng đánh đổi vào đó là bản linux này thiếu thư viện nhiều lắm. Nên muốn compile được hết ruby gem vẫn phải install các thư viện. Tuy nhiên vẫn tiết kiệm được dung lượng rất nhiều. Dockerfile lúc này:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">FROM ruby:2.5.3-alpine3.8
</span><span class="code-line">
</span><span class="code-line">RUN apk add --update build-base tzdata
</span><span class="code-line">
</span><span class="code-line">ENV RAILS_ENV ${RAILS_ENV}
</span><span class="code-line">ENV APP_HOME /code
</span><span class="code-line">
</span><span class="code-line">RUN mkdir $APP_HOME
</span><span class="code-line">
</span><span class="code-line">WORKDIR $APP_HOME
</span><span class="code-line">
</span><span class="code-line">ADD Gemfile* $APP_HOME/
</span><span class="code-line">RUN bundle install --jobs 4
</span><span class="code-line">
</span><span class="code-line">ADD . $APP_HOME
</span><span class="code-line">
</span><span class="code-line">EXPOSE 3000
</span><span class="code-line">
</span><span class="code-line">CMD bundle exec puma -C config/puma.rb
</span></code></pre></div>
<p>Sau khi build:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">╰─ docker images | head -2
</span><span class="code-line">REPOSITORY       TAG        IMAGE ID      CREATED              SIZE
</span><span class="code-line">ntloi            latest     688dc4bc5a1a  8 seconds ago        398MB
</span></code></pre></div>
<h3 id="multi-stage-build"><a href="#multi-stage-build" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Multi-stage build</h3>
<p>Sau khi dùng <code>ruby-alpine</code> để build thì ta xem lại docker history. Ta thấy dung lượng image vẫn còn lớn (gần ~400 MB). Nhiều nhất là lệnh:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">apk add — update build-base tzdata
</span></code></pre></div>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">╰─ docker history
</span><span class="code-line">ntloi:latestCREATED BY                                 SIZE
</span><span class="code-line">/bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;bund…          0B
</span><span class="code-line">/bin/sh -c #(nop)  EXPOSE 3000                         0B
</span><span class="code-line">/bin/sh -c #(nop)  ENV SECRET_KEY_BASE=$(rak…          0B
</span><span class="code-line">/bin/sh -c #(nop)  ADD dir:946653e21b282f5a10…         52.3MB
</span><span class="code-line">/bin/sh -c bundle install --jobs 4                     145MB
</span><span class="code-line">/bin/sh -c apk add --update build-base tzdata          154MB
</span></code></pre></div>
<p>Trong quá trình build app Ruby on Rails các thư viện, phần mềm trong build-base rất cần thiết. Tuy nhiên lúc run app thì các thư viện này không cần thiết nữa. Do đó ta nên tách quá trình build là 2 phần: Prebuild và build nhờ vào <a target="_blank" rel="noopener noreferrer" href="https://docs.docker.com/develop/develop-images/multistage-build/">multi-stage build</a>. Ta sẽ giảm được 154 MB của build-base.</p>
<h3 id="xóa-các-files-không-cần-thiết"><a href="#xóa-các-files-không-cần-thiết" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Xóa các files không cần thiết</h3>
<ul>
<li>Dùng file .dockerignore</li>
<li>Xóa các file cache và các file C để compile thư viện. Lúc đã biên dịch thư viện Ruby rồi thì khi run app, ta không cần các file này nữa.</li>
<li>Nếu trong môi trường Production, ta cũng ko nhất thiết cần các file kiểu như README.txt, spec, test,…. Hãy xóa chúng đi. Các thư mục có thể xóa trong môi trường Production bao gồm: spec, node_modules, app/assets, vendor/assets, lib/assets, tmp/cache, app/bin và các file text như README.txt</li>
</ul>
<p>Dockerfile hoàn thiện.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line"># ----------------------- STAGE 1 PRE-BUILD -----------------
</span><span class="code-line">FROM ruby:2.5.3-alpine3.8 AS pre-builder
</span><span class="code-line">
</span><span class="code-line">ENV RAILS_ENV ${RAILS_ENV}
</span><span class="code-line">ENV APP_HOME /code ENV BUNDLE_PATH /gems
</span><span class="code-line">
</span><span class="code-line">RUN apk add --update build-base tzdata \
</span><span class="code-line">    &amp;&amp; mkdir $APP_HOME
</span><span class="code-line">
</span><span class="code-line">WORKDIR $APP_HOME
</span><span class="code-line">
</span><span class="code-line">ADD . $APP_HOME \
</span><span class="code-line">    &amp;&amp; Gemfile* $APP_HOME/
</span><span class="code-line">
</span><span class="code-line">RUN bundle install --jobs 4
</span><span class="code-line">
</span><span class="code-line"># Xóa các file .o và file .c sau khi đã build xong gem.
</span><span class="code-line"># Các bạn có biết Ruby được viết bằng C không hả :))
</span><span class="code-line">RUN rm -rf /gems/cache/*.gem  \
</span><span class="code-line">    &amp;&amp; find /gems/gems/ -name &quot;*.c&quot; -delete \
</span><span class="code-line">    &amp;&amp; find /gems/gems/ -name &quot;*.o&quot; -delete
</span><span class="code-line">
</span><span class="code-line"># ------------------------ STAGE 2 BUILD --------------------
</span><span class="code-line">FROM ruby:2.5.3-alpine3.8
</span><span class="code-line">
</span><span class="code-line">ENV APP_HOME /code
</span><span class="code-line">ENV BUNDLE_PATH /gems
</span><span class="code-line">
</span><span class="code-line">RUN apk add --update tzdata
</span><span class="code-line">ARG RAILS_ENV=development
</span><span class="code-line">ENV RAILS_ENV ${RAILS_ENV}
</span><span class="code-line">WORKDIR $APP_HOME
</span><span class="code-line">
</span><span class="code-line"># Copy lại hết những gì đã build từ stage 1.
</span><span class="code-line">COPY --from=pre-builder $APP_HOME $APP_HOME \
</span><span class="code-line">     &amp;&amp; --from=pre-builder $BUNDLE_PATH $BUNDLE_PATH
</span><span class="code-line">
</span><span class="code-line">EXPOSE 3000
</span><span class="code-line">
</span><span class="code-line">CMD bundle exec puma -C config/puma.rb
</span></code></pre></div>
<p>Sau khi build:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">╰─ docker images | head -2
</span><span class="code-line">REPOSITORY       TAG        IMAGE ID      CREATED              SIZE
</span><span class="code-line">ntloi        latest     752fa284cb41     About a minute ago   124MB
</span></code></pre></div>
<p>124 MB nhé. File <code>.dockerignore</code> tham khảo</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">.env*
</span><span class="code-line">.git
</span><span class="code-line">.gitignore
</span><span class="code-line">.codeclimate.yml
</span><span class="code-line">.dockerignore
</span><span class="code-line">.gitlab-ci.yml
</span><span class="code-line">.hound.yml
</span><span class="code-line">.travis.yml
</span><span class="code-line">LICENSE.md
</span><span class="code-line">README.md
</span><span class="code-line">docker-compose.*
</span><span class="code-line">Dockerfile
</span><span class="code-line">log/*
</span><span class="code-line">node_modules/*
</span><span class="code-line">public/assets/*
</span><span class="code-line">storage/*
</span><span class="code-line">public/packs/*
</span><span class="code-line">public/packs-test/*
</span><span class="code-line">tmp/*
</span></code></pre></div>
<h2 id="một-số-lưu-ý-khác-khi-viết-dockerfile"><a href="#một-số-lưu-ý-khác-khi-viết-dockerfile" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Một số lưu ý khác khi viết Dockerfile</h2>
<h3 id="tận-dụng-các-layer-cache"><a href="#tận-dụng-các-layer-cache" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Tận dụng các layer cache</h3>
<p>Chúng ta đều biết Docker image bao gồm nhiều layer xếp chồng lên nhau. Để Docker build nhanh hơn chúng ta nên tận dụng việc cache các layer của các image đã build trước đó. Ta có thể dễ dàng nhìn thấy liệu 1 layer có được cache hay không nhờ vào các dòng log được in ra trong quá trình build.
Nếu một layer nằm ở dưới thay đổi thì các layer ở trên đều phải build mới lại chứ không thể dùng cache. Do đó, ta nên đặt các bước ít thay đổi lên trên đầu Dockerfile để dùng được cache, từ đó tăng tốc độ build Docker image.</p>
<h3 id="giảm-số-lượng-layer"><a href="#giảm-số-lượng-layer" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Giảm số lượng layer</h3>
<p>Thật ra tới khi tìm hiểu và viết bài thì mình mới biết được điều này. Docker image càng nhiều layer thì càng cồng kềnh (có tăng size, tăng build time không thì mình chưa kiểm chứng). Do đó chúng ta cần phải giảm bớt số lượng layer khi có thể.</p>
<p>Có 3 lệnh tạo ra Docker layer là: <strong>RUN</strong>, <strong>COPY</strong>, <strong>ADD</strong>. Cho nên việc viết như thế này:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">RUN bundle exec rake assets:clean
</span><span class="code-line">RUN bundle exec rake assets:precompile
</span><span class="code-line">RUN rm -rf /gems/cache/*.gem
</span></code></pre></div>
<p>Sẽ không tốt bằng viết thế này:</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">RUN bundle exec rake assets:clean \
</span><span class="code-line">&amp;&amp; bundle exec rake assets:precompile \
</span><span class="code-line">&amp;&amp; rm -rf /gems/cache/*.gem
</span></code></pre></div>
<p>Có một chút lưu ý là việc gom các lệnh này lại sẽ có thể ảnh hưởng đến việc cache layer ở trên. Do chỉ cần 1 trong 3 câu lệnh gộp này thay đổi cũng đồng nghĩa với việc cả 3 lệnh này phải bị chạy lại và ko thể dùng cache. Khi gom lưu ý tí xíu là được.</p>
<p>Hi vọng bài viết hữu ích cho các bạn.</p>
<p>Ref: <a target="_blank" rel="noopener noreferrer" href="https://thecode.pub/reduce-your-docker-images-an-example-with-ruby-564735f4388c">https://thecode.pub/reduce-your-docker-images-an-example-with-ruby-564735f4388c</a></p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"><a target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Ffossil-engineering.github.io%2Fblog%2Fdocker-size">Discuss on Twitter</a> • <a target="_blank" rel="noopener noreferrer" href="https://github.com/fossil-engineering/fossil-engineering.github.io/blob/master/data/blog/2020-01-04-docker-size.md">View on GitHub</a></div></div><footer><div class="text-sm font-medium leading-5 divide-gray-200 xl:divide-y dark:divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/engineering">engineering</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/git-hook-auto-prefix">Automatically prefix commit message with Git hook</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/1234">1,234 days — Day 1 at Fossil</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:people@fossil.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/fossil-engineering"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/company/fossilvietnamcareers/"><span class="sr-only">linkedin</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>© 2022</div><div> • </div><a href="/">Fossil Engineering</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var a=Object.defineProperty;var t=Object.getOwnPropertyDescriptor;var o=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var s=c=\u003ea(c,\"__esModule\",{value:!0});var g=(c,i)=\u003e()=\u003e(i||c((i={exports:{}}).exports,i),i.exports),u=(c,i)=\u003e{s(c);for(var l in i)a(c,l,{get:i[l],enumerable:!0})},N=(c,i,l)=\u003e{if(i\u0026\u0026typeof i==\"object\"||typeof i==\"function\")for(let e of o(i))!p.call(c,e)\u0026\u0026e!==\"default\"\u0026\u0026a(c,e,{get:()=\u003ei[e],enumerable:!(l=t(i,e))||l.enumerable});return c},b=c=\u003eN(s(a(c!=null?r(m(c)):{},\"default\",c\u0026\u0026c.__esModule\u0026\u0026\"default\"in c?{get:()=\u003ec.default,enumerable:!0}:{value:c,enumerable:!0})),c);var h=g((R,d)=\u003e{d.exports=_jsx_runtime});var E={};u(E,{default:()=\u003eD,frontmatter:()=\u003ek});var n=b(h()),k={title:\"Gi\\u1EA3m k\\xEDch th\\u01B0\\u1EDBc Docker image cho \\u1EE9ng d\\u1EE5ng Ruby on Rails\",date:\"2020-01-04\",authors:[\"loi\"],tags:[\"engineering\"],summary:\"Vi\\u1EC7c gi\\u1EA3m dung l\\u01B0\\u1EE3ng Docker image tu\\xE2n theo nguy\\xEAn t\\u1EAFc c\\u01A1 b\\u1EA3n nh\\u1EA5t ch\\xEDnh l\\xE0 lo\\u1EA1i b\\u1ECF c\\xE1c th\\xE0nh ph\\u1EA7n kh\\xF4ng c\\u1EA7n thi\\u1EBFt trong Docker image\"};function y(c={}){let{wrapper:i}=c.components||{};return i?(0,n.jsx)(i,Object.assign({},c,{children:(0,n.jsx)(l,{})})):l();function l(){let e=Object.assign({p:\"p\",img:\"img\",ul:\"ul\",li:\"li\",h2:\"h2\",a:\"a\",span:\"span\",h3:\"h3\",pre:\"pre\",code:\"code\",strong:\"strong\"},c.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/media/2020/docker.png\",alt:\"Docker\"})}),`\n`,(0,n.jsx)(e.p,{children:`Vi\\u1EC7c gi\\u1EA3m dung l\\u01B0\\u1EE3ng Docker image tu\\xE2n theo nguy\\xEAn t\\u1EAFc c\\u01A1 b\\u1EA3n nh\\u1EA5t ch\\xEDnh l\\xE0 lo\\u1EA1i b\\u1ECF c\\xE1c th\\xE0nh ph\\u1EA7n kh\\xF4ng c\\u1EA7n thi\\u1EBFt trong Docker image.\n\\u0110i\\u1EC1u n\\xE0y c\\xF3 th\\u1EC3 \\u0111\\u1EA1t \\u0111\\u01B0\\u1EE3c d\\u1EF1a v\\xE0o c\\xE1c th\\u1EE7 thu\\u1EADt sau:`}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"D\\xF9ng image base nh\\u1ECF: alpine, slim.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Multiple stages build.\"}),`\n`,(0,n.jsx)(e.li,{children:\"X\\xF3a c\\xE1c file ko c\\u1EA7n thi\\u1EBFt\"}),`\n`,(0,n.jsx)(e.li,{children:\"D\\xF9ng Dockerignore.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Gi\\u1EA3m s\\u1ED1 l\\u01B0\\u1EE3ng layer.\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u0110\\u1EC3 \\u0111\\u1ECDc b\\xE0i n\\xE0y c\\xE1c b\\u1EA1n c\\u1EA7n?\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Bi\\u1EBFt Docker l\\xE0 g\\xEC v\\xE0 d\\xF9ng \\u0111\\u1EC3 l\\xE0m g\\xEC.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Bi\\u1EBFt v\\xE0 \\u0111\\xE3 t\\u1EEBng vi\\u1EBFt Dockerfile, build Docker images.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Bi\\u1EBFt v\\xE0 t\\u1EEBng l\\xE0m vi\\u1EC7c v\\u1EDBi Ruby on Rails.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"v\\u1EA5n-\\u0111\\u1EC1-c\\u1EE7a-docker-images-qu\\xE1-n\\u1EB7ng\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#v\\u1EA5n-\\u0111\\u1EC1-c\\u1EE7a-docker-images-qu\\xE1-n\\u1EB7ng\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"V\\u1EA5n \\u0111\\u1EC1 c\\u1EE7a Docker images qu\\xE1 n\\u1EB7ng\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"c\\xE2u-chuy\\u1EC7n-c\\u1EE7a-m\\xECnh\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#c\\xE2u-chuy\\u1EC7n-c\\u1EE7a-m\\xECnh\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"C\\xE2u chuy\\u1EC7n c\\u1EE7a m\\xECnh\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Th\\u1EDDi gian tr\\u01B0\\u1EDBc, m\\xECnh c\\xF3 nh\\u1EADn m\\u1ED9t project, server \\u0111\\u1EB7t \\u1EDF Trung Qu\\u1ED1c. M\\u1EA1ng m\\u1EBDo M\\u1EABu Qu\\u1ED1c nh\\u01B0 m\\u1ECDi ng\\u01B0\\u1EDDi \\u0111\\u1EC1u bi\\u1EBFt, r\\u1EA5t ch\\u1EADm khi \\u0111i qua \\u0111\\u01B0\\u1EDDng truy\\u1EC1n qu\\u1ED1c t\\u1EBF, \\u0111\\u1EBFn c\\u1EA3 Google, Facebook \\u0111\\u1EC1u h\\u1EA7u nh\\u01B0 kh\\xF4ng s\\u1EED d\\u1EE5ng \\u0111\\u01B0\\u1EE3c. Code v\\xE0 CI server (CI server l\\xE0 server \\u0111\\u1EC3 th\\u1EF1c hi\\u1EC7n qu\\xE1 tr\\xECnh build Docker image t\\u1EEB code) th\\xEC \\u0111\\u1EB7t \\u1EDF M\\u1EF9 (v\\xEC \\u0111\\u01A1n gi\\u1EA3n b\\u1ECDn m\\xECnh d\\xF9ng Cloud provider, Git remote server \\u1EDF \\u0111\\u1EA5y). Push m\\u1ED9t Docker image 400 MB qua Trung Qu\\u1ED1c trung b\\xECnh m\\u1EA5t h\\u1EBFt 40 ph\\xFAt. Th\\u1EC9nh tho\\u1EA3ng th\\xEC h\\u01A1n 1 gi\\u1EDD. C\\xF3 khi \\u0111ang push gi\\u1EEFa ch\\u1EEBng th\\xEC b\\u1ECB disconnect lu\\xF4n.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Docker image qu\\xE1 l\\u1EDBn s\\u1EBD:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"T\\u1ED1n th\\u1EDDi gian upload.\"}),`\n`,(0,n.jsx)(e.li,{children:\"T\\u1ED1n b\\u0103ng th\\xF4ng m\\u1EA1ng. C\\xE1i n\\xE0y nguy hi\\u1EC3m n\\u1EBFu b\\u1EA1n s\\u1EED d\\u1EE5ng \\u0111\\u01B0\\u1EDDng m\\u1EA1ng ri\\xEAng, tr\\u1EA3 ti\\u1EC1n theo l\\u01B0u l\\u01B0\\u1EE3ng.\"}),`\n`,(0,n.jsx)(e.li,{children:\"T\\u1ED1n ti\\u1EC1n l\\u01B0u tr\\u1EEF image tr\\xEAn repository.\"}),`\n`,(0,n.jsx)(e.li,{children:\"\\u1EE8ng d\\u1EE5ng tr\\u1EDF n\\xEAn c\\u1ED3ng k\\u1EC1nh, th\\u1EDDi gian pull image s\\u1EBD l\\xE2u.\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"N\\xF3i chung l\\xE0 v\\u1EEBa t\\u1ED1n ti\\u1EC1n v\\u1EEBa \\u1EA3nh h\\u01B0\\u1EDFng t\\u1EDBi t\\u1ED1c \\u0111\\u1ED9 release s\\u1EA3n ph\\u1EA9m. C\\xE1c b\\u1EA1n th\\u1EED ngh\\u0129 xem, n\\u1EBFu c\\xE1c b\\u1EA1n ch\\u1EC9 mu\\u1ED1n \\u0111\\u1ED5i ch\\u1ED7 1 button tr\\xEAn qua ph\\u1EA3i 1 pixel, m\\xE0 b\\u1EA1n ph\\u1EA3i \\u0111\\u1EE3i 1 gi\\u1EDD \\u0111\\u1EC3 \\u0111\\u01B0a cho kh\\xE1ch h\\xE0ng xem. :) M\\xE0 l\\xE0m ph\\u1EA7n m\\u1EC1m th\\xEC requirement thay \\u0111\\u1ED5i li\\xEAn t\\u1EE5c. N\\xEAn m\\xECnh quy\\u1EBFt \\u0111\\u1ECBnh t\\xECm c\\xE1ch gi\\u1EA3m dung l\\u01B0\\u1EE3ng Docker image xu\\u1ED1ng.\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u0110\\xE2y l\\xE0 b\\xE0i vi\\u1EBFt h\\u01B0\\u1EDBng d\\u1EABn k\\u1EF9 thu\\u1EADt \\u0111\\u1EA7u ti\\xEAn c\\u1EE7a m\\xECnh, c\\u0169ng ch\\u1EC9 l\\xE0 m\\xFAa r\\xECu qua m\\u1EAFt th\\u1EE3 nh\\u01B0ng hy v\\u1ECDng n\\xF3 s\\u1EBD gi\\xFAp cho c\\xE1c b\\u1EA1n fresher, junior gi\\u1EA3i quy\\u1EBFt \\u0111\\u01B0\\u1EE3c v\\u1EA5n \\u0111\\u1EC1 v\\u1EC1 Docker image size qu\\xE1 l\\u1EDBn.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"v\\xED-d\\u1EE5-minh-h\\u1ECDa\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#v\\xED-d\\u1EE5-minh-h\\u1ECDa\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"V\\xED d\\u1EE5 minh h\\u1ECDa\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u0110\\u1EC3 cho d\\u1EC5 h\\xECnh dung, m\\xECnh s\\u1EBD l\\u1EA5y m\\u1ED9t Dockerfile \\u0111i\\u1EC3n h\\xECnh c\\u1EE7a Ruby on Rails \\u0111\\u1EC3 l\\xE0m v\\xED d\\u1EE5, c\\xF3 th\\u1EC3 s\\u1EBD thi\\u1EBFu v\\xE0 th\\u1EEBa m\\u1ED9t ch\\xFAt x\\xEDu.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`# K\\u1EBF th\\u1EEBa build base l\\xE0 image c\\u1EE7a ruby:2.5.3 phi\\xEAn b\\u1EA3n \\u0111\\u1EA7y \\u0111\\u1EE7, official tr\\xEAn Docker Hub.\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`FROM ruby:2.5.3\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# Ch\\u1EA1y hai l\\u1EC7nh apt-get (qu\\u1EA3n l\\xFD package c\\u1EE7a Ubuntu) \\u0111\\u1EC3 c\\xE0i nodejs (c\\u1EA7n trong qu\\xE1 tr\\xECnh build assets js, css c\\u1EE7a web), v\\xE0 build-base (build rubygems)\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN apt-get update\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN apt-get install -y nodejs build-base\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# Thi\\u1EBFt l\\u1EADp m\\u1ED9t s\\u1ED1 bi\\u1EBFn m\\xF4i tr\\u01B0\\u1EDDng cho Docker container.\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:\"ENV RAILS_ENV ${RAILS_ENV}\\n\"}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ENV APP_HOME /code\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# T\\u1EA1o th\\u01B0 m\\u1EE5c WORKDIR l\\u1EA5y t\\u1EEB ENV APP_HOME, m\\u1EB7c \\u0111\\u1ECBnh \\u1EDF tr\\xEAn l\\xE0 /code\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN mkdir $APP_HOME\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`WORKDIR $APP_HOME\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# Get dependencies c\\u1EE7a Rails\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ADD Gemfile* $APP_HOME/\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN bundle install - jobs 4\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# Copy h\\u1EBFt th\\u01B0 m\\u1EE5c hi\\u1EC7n t\\u1EA1i v\\xE0o th\\u01B0 m\\u1EE5c WORKDIR\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ADD . $APP_HOME\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# Docker container m\\u1EDF port 3000\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`EXPOSE 3000\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# Command run app\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CMD bundle exec puma -C config/puma.rb\n`})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"c\\xE1ch-gi\\u1EA3m-dung-l\\u01B0\\u1EE3ng-docker-image\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#c\\xE1ch-gi\\u1EA3m-dung-l\\u01B0\\u1EE3ng-docker-image\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"C\\xE1ch gi\\u1EA3m dung l\\u01B0\\u1EE3ng Docker image\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"ki\\u1EC3m-tra-dung-l\\u01B0\\u1EE3ng-docker-image\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#ki\\u1EC3m-tra-dung-l\\u01B0\\u1EE3ng-docker-image\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Ki\\u1EC3m tra dung l\\u01B0\\u1EE3ng Docker image\"]}),`\n`,(0,n.jsx)(e.p,{children:\"M\\xECnh build Dockerfile \\u1EDF tr\\xEAn, l\\u1EC7nh list docker images s\\u1EBD cho ta th\\u1EA5y dung l\\u01B0\\u1EE3ng c\\u1EE7a image \\u1EDF c\\u1ED9t cu\\u1ED1i c\\xF9ng.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2570\\u2500 docker images | head -2\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`REPOSITORY       TAG        IMAGE ID       CREATED              SIZE\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ntloi            latest     2343d383ebca  About ...ago        1.12GB\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"What? 1.12 GB =))\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u0110\\u1EC3 hi\\u1EC3u r\\xF5 t\\u1EA1i sao l\\u1EA1i to nh\\u01B0 v\\u1EADy ta d\\xF9ng l\\u1EC7nh docker history. (Th\\u1EE9 t\\u1EF1 c\\xE1c c\\xE2u l\\u1EC7nh s\\u1EBD b\\u1ECB ng\\u01B0\\u1EE3c so v\\u1EDBi Docker file, do c\\xE1c layer stack l\\xEAn nhau).\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2570\\u2500 docker history ntloi:latest\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CREATED BY                                      SIZE\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c #(nop)  CMD [\"/bin/sh\" \"-c\" \"bund\\u2026   0B\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c #(nop)  EXPOSE 3000                  0B\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c #(nop) ADD dir:0c93aceee1fd93e794\\u2026   52.3MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c bundle install --jobs 4              158MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c apt-get install -y nodejs --no-in\\u2026   16.5MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c apt-get update                       16.4MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c set -ex   \u0026\u0026 buildDeps='   bison \\u2026   37.7MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c mkdir -p /usr/local/etc  \u0026\u0026 {   e\\u2026   45B\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c set -ex;  apt-get update;  apt-ge\\u2026   562MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c apt-get update \u0026\u0026 apt-get install\\u2026   142MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c set -ex;  if ! command -v gpg \u003e /\\u2026   7.81MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c apt-get update \u0026\u0026 apt-get install\\u2026   23.2MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`...\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c #(nop) ADD file:e4bdc12117ee95eaa\\u2026   101MB\n`})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"d\\xF9ng-alpine-image\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#d\\xF9ng-alpine-image\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"D\\xF9ng alpine image\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"R\\xF5 r\\xE0ng l\\xE0 c\\xE1c layer in \\u0111\\u1EADm kh\\xF4ng ph\\u1EA3i m\\xECnh t\\u1EA1o ra. N\\xF3 l\\xE0 layer c\\u1EE7a c\\xE2u l\\u1EC7nh \\u0111\\u1EA7u ti\\xEAn trong Dockerfile: \",(0,n.jsx)(e.code,{children:\"FROM ruby:2.5.3\"}),\" (G\\u1EA7n 900 MB).\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Gi\\u1EA3i quy\\u1EBFt v\\u1EA5n \\u0111\\u1EC1 n\\xE0y ta c\\xF3 th\\u1EC3 d\\xF9ng c\\xE1c images ruby kh\\xE1c nh\\u1EB9 h\\u01A1n, nh\\u1EB9 nh\\u1EA5t \\u1EDF \\u0111\\xE2y l\\xE0 nh\\xF3m alpine. C\\xF3 th\\u1EC3 b\\u1EA1n ch\\u01B0a bi\\u1EBFt alpine l\\xE0 b\\u1EA3n ph\\xE2n ph\\u1ED1i linux nh\\u1EB9 b\\u1EADc nh\\u1EA5t. V\\xE0 ruby 2.5.3 c\\xE0i tr\\xEAn alpine c\\u1EE1 ~ 22 MB. Nh\\u01B0ng \\u0111\\xE1nh \\u0111\\u1ED5i v\\xE0o \\u0111\\xF3 l\\xE0 b\\u1EA3n linux n\\xE0y thi\\u1EBFu th\\u01B0 vi\\u1EC7n nhi\\u1EC1u l\\u1EAFm. N\\xEAn mu\\u1ED1n compile \\u0111\\u01B0\\u1EE3c h\\u1EBFt ruby gem v\\u1EABn ph\\u1EA3i install c\\xE1c th\\u01B0 vi\\u1EC7n. Tuy nhi\\xEAn v\\u1EABn ti\\u1EBFt ki\\u1EC7m \\u0111\\u01B0\\u1EE3c dung l\\u01B0\\u1EE3ng r\\u1EA5t nhi\\u1EC1u. Dockerfile l\\xFAc n\\xE0y:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`FROM ruby:2.5.3-alpine3.8\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN apk add --update build-base tzdata\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:\"ENV RAILS_ENV ${RAILS_ENV}\\n\"}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ENV APP_HOME /code\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN mkdir $APP_HOME\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`WORKDIR $APP_HOME\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ADD Gemfile* $APP_HOME/\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN bundle install --jobs 4\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ADD . $APP_HOME\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`EXPOSE 3000\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CMD bundle exec puma -C config/puma.rb\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Sau khi build:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2570\\u2500 docker images | head -2\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`REPOSITORY       TAG        IMAGE ID      CREATED              SIZE\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ntloi            latest     688dc4bc5a1a  8 seconds ago        398MB\n`})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"multi-stage-build\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#multi-stage-build\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Multi-stage build\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Sau khi d\\xF9ng \",(0,n.jsx)(e.code,{children:\"ruby-alpine\"}),\" \\u0111\\u1EC3 build th\\xEC ta xem l\\u1EA1i docker history. Ta th\\u1EA5y dung l\\u01B0\\u1EE3ng image v\\u1EABn c\\xF2n l\\u1EDBn (g\\u1EA7n ~400 MB). Nhi\\u1EC1u nh\\u1EA5t l\\xE0 l\\u1EC7nh:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`apk add \\u2014 update build-base tzdata\n`})})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2570\\u2500 docker history\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ntloi:latestCREATED BY                                 SIZE\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c #(nop)  CMD [\"/bin/sh\" \"-c\" \"bund\\u2026          0B\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c #(nop)  EXPOSE 3000                         0B\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c #(nop)  ENV SECRET_KEY_BASE=$(rak\\u2026          0B\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c #(nop)  ADD dir:946653e21b282f5a10\\u2026         52.3MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c bundle install --jobs 4                     145MB\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`/bin/sh -c apk add --update build-base tzdata          154MB\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Trong qu\\xE1 tr\\xECnh build app Ruby on Rails c\\xE1c th\\u01B0 vi\\u1EC7n, ph\\u1EA7n m\\u1EC1m trong build-base r\\u1EA5t c\\u1EA7n thi\\u1EBFt. Tuy nhi\\xEAn l\\xFAc run app th\\xEC c\\xE1c th\\u01B0 vi\\u1EC7n n\\xE0y kh\\xF4ng c\\u1EA7n thi\\u1EBFt n\\u1EEFa. Do \\u0111\\xF3 ta n\\xEAn t\\xE1ch qu\\xE1 tr\\xECnh build l\\xE0 2 ph\\u1EA7n: Prebuild v\\xE0 build nh\\u1EDD v\\xE0o \",(0,n.jsx)(e.a,{href:\"https://docs.docker.com/develop/develop-images/multistage-build/\",children:\"multi-stage build\"}),\". Ta s\\u1EBD gi\\u1EA3m \\u0111\\u01B0\\u1EE3c 154 MB c\\u1EE7a build-base.\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"x\\xF3a-c\\xE1c-files-kh\\xF4ng-c\\u1EA7n-thi\\u1EBFt\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#x\\xF3a-c\\xE1c-files-kh\\xF4ng-c\\u1EA7n-thi\\u1EBFt\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"X\\xF3a c\\xE1c files kh\\xF4ng c\\u1EA7n thi\\u1EBFt\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"D\\xF9ng file .dockerignore\"}),`\n`,(0,n.jsx)(e.li,{children:\"X\\xF3a c\\xE1c file cache v\\xE0 c\\xE1c file C \\u0111\\u1EC3 compile th\\u01B0 vi\\u1EC7n. L\\xFAc \\u0111\\xE3 bi\\xEAn d\\u1ECBch th\\u01B0 vi\\u1EC7n Ruby r\\u1ED3i th\\xEC khi run app, ta kh\\xF4ng c\\u1EA7n c\\xE1c file n\\xE0y n\\u1EEFa.\"}),`\n`,(0,n.jsx)(e.li,{children:\"N\\u1EBFu trong m\\xF4i tr\\u01B0\\u1EDDng Production, ta c\\u0169ng ko nh\\u1EA5t thi\\u1EBFt c\\u1EA7n c\\xE1c file ki\\u1EC3u nh\\u01B0 README.txt, spec, test,\\u2026. H\\xE3y x\\xF3a ch\\xFAng \\u0111i. C\\xE1c th\\u01B0 m\\u1EE5c c\\xF3 th\\u1EC3 x\\xF3a trong m\\xF4i tr\\u01B0\\u1EDDng Production bao g\\u1ED3m: spec, node_modules, app/assets, vendor/assets, lib/assets, tmp/cache, app/bin v\\xE0 c\\xE1c file text nh\\u01B0 README.txt\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Dockerfile ho\\xE0n thi\\u1EC7n.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`# ----------------------- STAGE 1 PRE-BUILD -----------------\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`FROM ruby:2.5.3-alpine3.8 AS pre-builder\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:\"ENV RAILS_ENV ${RAILS_ENV}\\n\"}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ENV APP_HOME /code ENV BUNDLE_PATH /gems\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN apk add --update build-base tzdata \\\\\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \u0026\u0026 mkdir $APP_HOME\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`WORKDIR $APP_HOME\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ADD . $APP_HOME \\\\\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \u0026\u0026 Gemfile* $APP_HOME/\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN bundle install --jobs 4\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# X\\xF3a c\\xE1c file .o v\\xE0 file .c sau khi \\u0111\\xE3 build xong gem.\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# C\\xE1c b\\u1EA1n c\\xF3 bi\\u1EBFt Ruby \\u0111\\u01B0\\u1EE3c vi\\u1EBFt b\\u1EB1ng C kh\\xF4ng h\\u1EA3 :))\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN rm -rf /gems/cache/*.gem  \\\\\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \u0026\u0026 find /gems/gems/ -name \"*.c\" -delete \\\\\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \u0026\u0026 find /gems/gems/ -name \"*.o\" -delete\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# ------------------------ STAGE 2 BUILD --------------------\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`FROM ruby:2.5.3-alpine3.8\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ENV APP_HOME /code\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ENV BUNDLE_PATH /gems\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN apk add --update tzdata\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ARG RAILS_ENV=development\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:\"ENV RAILS_ENV ${RAILS_ENV}\\n\"}),(0,n.jsx)(e.span,{className:\"code-line\",children:`WORKDIR $APP_HOME\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`# Copy l\\u1EA1i h\\u1EBFt nh\\u1EEFng g\\xEC \\u0111\\xE3 build t\\u1EEB stage 1.\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`COPY --from=pre-builder $APP_HOME $APP_HOME \\\\\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`     \u0026\u0026 --from=pre-builder $BUNDLE_PATH $BUNDLE_PATH\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`EXPOSE 3000\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`CMD bundle exec puma -C config/puma.rb\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Sau khi build:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2570\\u2500 docker images | head -2\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`REPOSITORY       TAG        IMAGE ID      CREATED              SIZE\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ntloi        latest     752fa284cb41     About a minute ago   124MB\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"124 MB nh\\xE9. File \",(0,n.jsx)(e.code,{children:\".dockerignore\"}),\" tham kh\\u1EA3o\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`.env*\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`.git\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`.gitignore\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`.codeclimate.yml\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`.dockerignore\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`.gitlab-ci.yml\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`.hound.yml\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`.travis.yml\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`LICENSE.md\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`README.md\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`docker-compose.*\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Dockerfile\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`log/*\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`node_modules/*\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`public/assets/*\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`storage/*\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`public/packs/*\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`public/packs-test/*\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`tmp/*\n`})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"m\\u1ED9t-s\\u1ED1-l\\u01B0u-\\xFD-kh\\xE1c-khi-vi\\u1EBFt-dockerfile\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#m\\u1ED9t-s\\u1ED1-l\\u01B0u-\\xFD-kh\\xE1c-khi-vi\\u1EBFt-dockerfile\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"M\\u1ED9t s\\u1ED1 l\\u01B0u \\xFD kh\\xE1c khi vi\\u1EBFt Dockerfile\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"t\\u1EADn-d\\u1EE5ng-c\\xE1c-layer-cache\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#t\\u1EADn-d\\u1EE5ng-c\\xE1c-layer-cache\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"T\\u1EADn d\\u1EE5ng c\\xE1c layer cache\"]}),`\n`,(0,n.jsx)(e.p,{children:`Ch\\xFAng ta \\u0111\\u1EC1u bi\\u1EBFt Docker image bao g\\u1ED3m nhi\\u1EC1u layer x\\u1EBFp ch\\u1ED3ng l\\xEAn nhau. \\u0110\\u1EC3 Docker build nhanh h\\u01A1n ch\\xFAng ta n\\xEAn t\\u1EADn d\\u1EE5ng vi\\u1EC7c cache c\\xE1c layer c\\u1EE7a c\\xE1c image \\u0111\\xE3 build tr\\u01B0\\u1EDBc \\u0111\\xF3. Ta c\\xF3 th\\u1EC3 d\\u1EC5 d\\xE0ng nh\\xECn th\\u1EA5y li\\u1EC7u 1 layer c\\xF3 \\u0111\\u01B0\\u1EE3c cache hay kh\\xF4ng nh\\u1EDD v\\xE0o c\\xE1c d\\xF2ng log \\u0111\\u01B0\\u1EE3c in ra trong qu\\xE1 tr\\xECnh build.\nN\\u1EBFu m\\u1ED9t layer n\\u1EB1m \\u1EDF d\\u01B0\\u1EDBi thay \\u0111\\u1ED5i th\\xEC c\\xE1c layer \\u1EDF tr\\xEAn \\u0111\\u1EC1u ph\\u1EA3i build m\\u1EDBi l\\u1EA1i ch\\u1EE9 kh\\xF4ng th\\u1EC3 d\\xF9ng cache. Do \\u0111\\xF3, ta n\\xEAn \\u0111\\u1EB7t c\\xE1c b\\u01B0\\u1EDBc \\xEDt thay \\u0111\\u1ED5i l\\xEAn tr\\xEAn \\u0111\\u1EA7u Dockerfile \\u0111\\u1EC3 d\\xF9ng \\u0111\\u01B0\\u1EE3c cache, t\\u1EEB \\u0111\\xF3 t\\u0103ng t\\u1ED1c \\u0111\\u1ED9 build Docker image.`}),`\n`,(0,n.jsxs)(e.h3,{id:\"gi\\u1EA3m-s\\u1ED1-l\\u01B0\\u1EE3ng-layer\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#gi\\u1EA3m-s\\u1ED1-l\\u01B0\\u1EE3ng-layer\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Gi\\u1EA3m s\\u1ED1 l\\u01B0\\u1EE3ng layer\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Th\\u1EADt ra t\\u1EDBi khi t\\xECm hi\\u1EC3u v\\xE0 vi\\u1EBFt b\\xE0i th\\xEC m\\xECnh m\\u1EDBi bi\\u1EBFt \\u0111\\u01B0\\u1EE3c \\u0111i\\u1EC1u n\\xE0y. Docker image c\\xE0ng nhi\\u1EC1u layer th\\xEC c\\xE0ng c\\u1ED3ng k\\u1EC1nh (c\\xF3 t\\u0103ng size, t\\u0103ng build time kh\\xF4ng th\\xEC m\\xECnh ch\\u01B0a ki\\u1EC3m ch\\u1EE9ng). Do \\u0111\\xF3 ch\\xFAng ta c\\u1EA7n ph\\u1EA3i gi\\u1EA3m b\\u1EDBt s\\u1ED1 l\\u01B0\\u1EE3ng layer khi c\\xF3 th\\u1EC3.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"C\\xF3 3 l\\u1EC7nh t\\u1EA1o ra Docker layer l\\xE0: \",(0,n.jsx)(e.strong,{children:\"RUN\"}),\", \",(0,n.jsx)(e.strong,{children:\"COPY\"}),\", \",(0,n.jsx)(e.strong,{children:\"ADD\"}),\". Cho n\\xEAn vi\\u1EC7c vi\\u1EBFt nh\\u01B0 th\\u1EBF n\\xE0y:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN bundle exec rake assets:clean\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN bundle exec rake assets:precompile\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN rm -rf /gems/cache/*.gem\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"S\\u1EBD kh\\xF4ng t\\u1ED1t b\\u1EB1ng vi\\u1EBFt th\\u1EBF n\\xE0y:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsxs)(e.code,{className:\"code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`RUN bundle exec rake assets:clean \\\\\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\u0026\u0026 bundle exec rake assets:precompile \\\\\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\u0026\u0026 rm -rf /gems/cache/*.gem\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"C\\xF3 m\\u1ED9t ch\\xFAt l\\u01B0u \\xFD l\\xE0 vi\\u1EC7c gom c\\xE1c l\\u1EC7nh n\\xE0y l\\u1EA1i s\\u1EBD c\\xF3 th\\u1EC3 \\u1EA3nh h\\u01B0\\u1EDFng \\u0111\\u1EBFn vi\\u1EC7c cache layer \\u1EDF tr\\xEAn. Do ch\\u1EC9 c\\u1EA7n 1 trong 3 c\\xE2u l\\u1EC7nh g\\u1ED9p n\\xE0y thay \\u0111\\u1ED5i c\\u0169ng \\u0111\\u1ED3ng ngh\\u0129a v\\u1EDBi vi\\u1EC7c c\\u1EA3 3 l\\u1EC7nh n\\xE0y ph\\u1EA3i b\\u1ECB ch\\u1EA1y l\\u1EA1i v\\xE0 ko th\\u1EC3 d\\xF9ng cache. Khi gom l\\u01B0u \\xFD t\\xED x\\xEDu l\\xE0 \\u0111\\u01B0\\u1EE3c.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Hi v\\u1ECDng b\\xE0i vi\\u1EBFt h\\u1EEFu \\xEDch cho c\\xE1c b\\u1EA1n.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Ref: \",(0,n.jsx)(e.a,{href:\"https://thecode.pub/reduce-your-docker-images-an-example-with-ruby-564735f4388c\",children:\"https://thecode.pub/reduce-your-docker-images-an-example-with-ruby-564735f4388c\"})]})]})}}var D=y;return E;})();\n;return Component;","toc":[{"value":"Vấn đề của Docker images quá nặng","url":"#vấn-đề-của-docker-images-quá-nặng","depth":2},{"value":"Câu chuyện của mình","url":"#câu-chuyện-của-mình","depth":3},{"value":"Ví dụ minh họa","url":"#ví-dụ-minh-họa","depth":3},{"value":"Cách giảm dung lượng Docker image","url":"#cách-giảm-dung-lượng-docker-image","depth":2},{"value":"Kiểm tra dung lượng Docker image","url":"#kiểm-tra-dung-lượng-docker-image","depth":3},{"value":"Dùng alpine image","url":"#dùng-alpine-image","depth":3},{"value":"Multi-stage build","url":"#multi-stage-build","depth":3},{"value":"Xóa các files không cần thiết","url":"#xóa-các-files-không-cần-thiết","depth":3},{"value":"Một số lưu ý khác khi viết Dockerfile","url":"#một-số-lưu-ý-khác-khi-viết-dockerfile","depth":2},{"value":"Tận dụng các layer cache","url":"#tận-dụng-các-layer-cache","depth":3},{"value":"Giảm số lượng layer","url":"#giảm-số-lượng-layer","depth":3}],"frontMatter":{"readingTime":{"text":"9 min read","minutes":8.835,"time":530100,"words":1767},"slug":"docker-size","fileName":"2020-01-04-docker-size.md","title":"Giảm kích thước Docker image cho ứng dụng Ruby on Rails","date":"2020-01-04T00:00:00.000Z","authors":["loi"],"tags":["engineering"],"summary":"Việc giảm dung lượng Docker image tuân theo nguyên tắc cơ bản nhất chính là loại bỏ các thành phần không cần thiết trong Docker image"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.175,"time":10500,"words":35},"slug":["loi"],"fileName":"loi.md","name":"Loi Nguyen","avatar":"https://avatars.githubusercontent.com/u/9493402?v=4","occupation":"Data Engineer","company":"Fossil Vietnam","email":null,"linkedin":"https://www.linkedin.com/in/nguyenthanhloi/","github":"https://github.com/ntloi95","date":null}],"prev":{"title":"Automatically prefix commit message with Git hook","authors":["cat"],"date":"2019-03-09T00:00:00.000Z","tags":["engineering","git"],"summary":"In order to find all the commits relating to a specific JIRA issue as well as find the issue relating to a specific commit quickly, my team applies a common pattern for all commit message in our projects: `[ISSUE] MESSAGE`","slug":"git-hook-auto-prefix"},"next":{"title":"1,234 days — Day 1 at Fossil","authors":["nga"],"date":"2020-02-27T00:00:00.000Z","tags":["life"],"summary":"A thousand-ish more days later, I could definitely testify to the jaded Day 1 philosophy by Amazon CEO Jeff Bezos: Every day here has felt just like Day 1.","layout":"PostLayout","slug":"1234"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["docker-size"]},"buildId":"bYvShaFajK7r1Z24hTcnv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>