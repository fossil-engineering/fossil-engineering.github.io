<!DOCTYPE html><html lang="en"><head><meta name="robots" content="follow, index"/><meta name="description" content="Clone and deploy your own Next.js portfolio in minutes."/><meta property="og:site_name" content="Fossil Engineering Blog"/><meta property="og:description" content="Clone and deploy your own Next.js portfolio in minutes."/><meta property="og:title" content="Fossil Engineering Blog"/><meta property="og:image" content="https://assets.vercel.com/image/upload/q_auto/front/vercel/dps.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@yourname"/><meta name="twitter:title" content="Fossil Engineering Blog"/><meta name="twitter:description" content="Clone and deploy your own Next.js portfolio in minutes."/><meta name="twitter:image" content="https://assets.vercel.com/image/upload/q_auto/front/vercel/dps.png"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"/><link rel="preload" href="/fonts/Inter-roman.latin.var.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><title>Automatically prefix commit message with Git hook</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/371dff837120cb73.css" as="style"/><link rel="stylesheet" href="/_next/static/css/371dff837120cb73.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-d5c96c6d07ca9fe9.js" defer=""></script><script src="/_next/static/chunks/main-6099a486a931d74e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d4e301a789957741.js" defer=""></script><script src="/_next/static/chunks/686-5a29d4349fbf40a7.js" defer=""></script><script src="/_next/static/chunks/pages/engineering/git-hook-auto-prefix-97e26cc73fcaf2b3.js" defer=""></script><script src="/_next/static/ui41WN5exivHjU4b-U04r/_buildManifest.js" defer=""></script><script src="/_next/static/ui41WN5exivHjU4b-U04r/_ssgManifest.js" defer=""></script><script src="/_next/static/ui41WN5exivHjU4b-U04r/_middlewareManifest.js" defer=""></script><style id="__jsx-7c359fde634f3543">a.jsx-7c359fde634f3543 {float:right}
@media screen and (max-width:480px) {article.jsx-7c359fde634f3543 {padding-top:2rem;
padding-bottom:4rem}}</style></head><body><div id="__next"><article class="container prose prose-sm md:prose"><h1>Automatically prefix commit message with Git hook</h1><div class="meta-line"><div class="meta">Cat Vu<!-- -->, <time>Sat Mar 09 2019</time> • <a class="tag" href="/tags/engineering">engineering</a></div><a class="meta-back" href="/engineering">Back</a></div><h2><span class="subheading-anchor" id="problem"></span><a href="#problem" class="subheading">Problem<span class="anchor-icon" aria-hidden="true">#</span></a></h2><p>In order to find all the commits relating to a specific JIRA issue as well as find the issue relating to a specific commit quickly, my team applies a common pattern for all commit message in our projects: <code>[ISSUE] MESSAGE</code></p><p>For example, <code>git commit -m &quot;[ISSUE-123] Fix something&quot;</code></p><p>After a while using this convention, I think it’s a bit inconvenient and silly for us to remember and type the same issue id whenever we commit a change to the code base.</p><p>So my expectation is: After I commit a change, Git will trigger a hook that automatically prepends my message with the related issue id.</p><p>Thankfully, I figured out we can easily achieve this with a Git hook.</p><h2><span class="subheading-anchor" id="quick-start"></span><a href="#quick-start" class="subheading">Quick start<span class="anchor-icon" aria-hidden="true">#</span></a></h2><p>From the current project, switch to a new branch (e.g. <code>feature/demo</code>) and create a file named <code>prepare-commit-msg</code> under<code> &lt;project&gt;/.git/hooks</code> with following content</p><pre><code># project/.git/hooks/prepare-commit-msg:

#!/bin/bash
[[ ! -f .git/jira ]] &amp;&amp; touch .git/jira
BRANCH=$(git rev-parse --abbrev-ref HEAD)
ISSUE=$(cat .git/jira | grep -E &quot;^$BRANCH &quot; | awk &#x27;{print $2}&#x27;)
[[ &quot;$ISSUE&quot; != &quot;&quot; ]] &amp;&amp; sed -i.bak -e &quot;1s/^/[$ISSUE] /&quot; $1 || true
</code></pre><p>Make it executable</p><pre><code>chmod +x .git/hooks/prepare-commit-msg
</code></pre><p>Now, when we commit a change, e.g. <code>git commit -m &quot;Fix something&quot;</code>, the above script will be triggered and do the following steps:</p><ol><li>Get the name of the current branch: <code>feature/demo</code></li><li>Derive the issue id from the branch name: e.g. <code>ISSUE-123</code></li><li>Prepend the commit message with the issue id: =&gt; <code>[ISSUE-123] Fix something</code></li></ol><p>Create <code>.git/jira</code> file to store issue ids along with corresponding branches</p><pre><code>touch .git/jira
</code></pre><p>Now we can test the hook.</p><pre><code>echo &quot;feature/demo ISSUE-123&quot; &gt; .git/jira
git commit -m &quot;Test&quot; --allow-empty
# the message is now prepended with the issue id
# [ISSUE-123] Test
</code></pre><h2><span class="subheading-anchor" id="globalize-the-hook"></span><a href="#globalize-the-hook" class="subheading">Globalize the hook<span class="anchor-icon" aria-hidden="true">#</span></a></h2><p>If you have many projects and you don’t want to create prepare-commit-msg file over and over again for each project, you can make it become a global hook. [Matt Venables](Matt Venables) wrote a great post about this. Please check it out at <a target="_blank" rel="noopener" href="https://coderwall.com/p/jp7d5q/create-a-global-git-commit-hook">https://coderwall.com/p/jp7d5q/create-a-global-git-commit-hook</a></p><h2><span class="subheading-anchor" id="alias-mapping-steps"></span><a href="#alias-mapping-steps" class="subheading">Alias mapping steps<span class="anchor-icon" aria-hidden="true">#</span></a></h2><p>As you can see even the hook becomes global, we still have to do the last step manually to map the issue id to the working branch. We can improve this by wrapping all the steps inside a single function and alias it so that we just need to call something like <code>jira ISSUE-123</code> to set up everything.</p><p>Open <code>~/.bashrc</code> file and add the following code:</p><pre><code>map_jira_id () {
  [ ! -d .git ] &amp;&amp; return 1
  [ ! -f .git/jira ] &amp;&amp; touch .git/jira
  BRANCH=$(git rev-parse --abbrev-ref HEAD)
  MATCH=$(echo &quot;$BRANCH&quot; | sed &#x27;s/\//\\\//g&#x27;)
  ISSUES=$(sed &quot;/^$MATCH /d&quot; .git/jira)
  ISSUES=&quot;$BRANCH $1\n$ISSUES&quot;
  echo &quot;$ISSUES&quot; &gt; .git/jira
}
alias jira=&quot;map_jira_id&quot;
</code></pre><p>Save it and source <code>~/.bashrc</code> to apply the change</p><h2><span class="subheading-anchor" id="test"></span><a href="#test" class="subheading">Test<span class="anchor-icon" aria-hidden="true">#</span></a></h2><p>Now that we have created a global hook and a function alias. It’s time to test on another project.</p><p>From the project folder, populate hook templates (according to Matt’s post)</p><pre><code>git init
</code></pre><p>Test if the hook work properly</p><pre><code>/project2(master)$ git checkout feature/foo
/project2(feature/foo)$ jira ABC-123
/project2(feature/foo)$ git commit -m &quot;Test&quot; --allow-empty
# [ABC-123] Test
/project2(feature/foo)$ git checkout feature/bar
/project2(feature/bar)$ jira ABC-456
/project2(feature/bar)$ git commit -m &quot;Test&quot; --allow-empty
# [ABC-456] Test
</code></pre><p>Hope this helps!</p><small style="display:block;margin-top:8rem" class="jsx-7c359fde634f3543"><time class="jsx-7c359fde634f3543">2021</time> © Fossil Engineering Blog.<a href="/feed.xml" class="jsx-7c359fde634f3543">RSS</a></small></article></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/engineering/git-hook-auto-prefix","query":{},"buildId":"ui41WN5exivHjU4b-U04r","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>