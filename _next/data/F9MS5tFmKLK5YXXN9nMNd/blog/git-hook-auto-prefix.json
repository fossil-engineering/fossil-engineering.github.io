{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var r=Object.create;var t=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var l=i=>t(i,\"__esModule\",{value:!0});var g=(i,a)=>()=>(a||i((a={exports:{}}).exports,a),a.exports),u=(i,a)=>{l(i);for(var c in a)t(i,c,{get:a[c],enumerable:!0})},f=(i,a,c)=>{if(a&&typeof a==\"object\"||typeof a==\"function\")for(let n of d(a))!p.call(i,n)&&n!==\"default\"&&t(i,n,{get:()=>a[n],enumerable:!(c=h(a,n))||c.enumerable});return i},N=i=>f(l(t(i!=null?r(m(i)):{},\"default\",i&&i.__esModule&&\"default\"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);var s=g((I,o)=>{o.exports=_jsx_runtime});var S={};u(S,{default:()=>w,frontmatter:()=>b});var e=N(s()),b={title:\"Automatically prefix commit message with Git hook\",authors:[\"cat\"],date:\"2019-03-09\",tags:[\"engineering\",\"git\"],summary:\"In order to find all the commits relating to a specific JIRA issue as well as find the issue relating to a specific commit quickly, my team applies a common pattern for all commit message in our projects: `[ISSUE] MESSAGE`\"};function j(i={}){let{wrapper:a}=i.components||{};return a?(0,e.jsx)(a,Object.assign({},i,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",code:\"code\",pre:\"pre\",ol:\"ol\",li:\"li\"},i.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"problem\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#problem\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Problem\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"In order to find all the commits relating to a specific JIRA issue as well as find the issue relating to a specific commit quickly, my team applies a common pattern for all commit message in our projects: \",(0,e.jsx)(n.code,{children:\"[ISSUE] MESSAGE\"})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"For example, \",(0,e.jsx)(n.code,{children:'git commit -m \"[ISSUE-123] Fix something\"'})]}),`\n`,(0,e.jsx)(n.p,{children:\"After a while using this convention, I think it\\u2019s a bit inconvenient and silly for us to remember and type the same issue id whenever we commit a change to the code base.\"}),`\n`,(0,e.jsx)(n.p,{children:\"So my expectation is: After I commit a change, Git will trigger a hook that automatically prepends my message with the related issue id.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Thankfully, I figured out we can easily achieve this with a Git hook.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"quick-start\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#quick-start\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Quick start\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"From the current project, switch to a new branch (e.g. \",(0,e.jsx)(n.code,{children:\"feature/demo\"}),\") and create a file named \",(0,e.jsx)(n.code,{children:\"prepare-commit-msg\"}),\" under \",(0,e.jsx)(n.code,{children:\"<project>/.git/hooks\"}),\" with following content\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`# project/.git/hooks/prepare-commit-msg:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`#!/bin/bash\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[[ ! -f .git/jira ]] && touch .git/jira\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`BRANCH=$(git rev-parse --abbrev-ref HEAD)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ISSUE=$(cat .git/jira | grep -E \"^$BRANCH \" | awk '{print $2}')\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`[[ \"$ISSUE\" != \"\" ]] && sed -i.bak -e \"1s/^/[$ISSUE] /\" $1 || true\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Make it executable\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`chmod +x .git/hooks/prepare-commit-msg\n`})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now, when we commit a change, e.g. \",(0,e.jsx)(n.code,{children:'git commit -m \"Fix something\"'}),\", the above script will be triggered and do the following steps:\"]}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"Get the name of the current branch: \",(0,e.jsx)(n.code,{children:\"feature/demo\"})]}),`\n`,(0,e.jsxs)(n.li,{children:[\"Derive the issue id from the branch name: e.g. \",(0,e.jsx)(n.code,{children:\"ISSUE-123\"})]}),`\n`,(0,e.jsxs)(n.li,{children:[\"Prepend the commit message with the issue id: => \",(0,e.jsx)(n.code,{children:\"[ISSUE-123] Fix something\"})]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Create \",(0,e.jsx)(n.code,{children:\".git/jira\"}),\" file to store issue ids along with corresponding branches\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`touch .git/jira\n`})})}),`\n`,(0,e.jsx)(n.p,{children:\"Now we can test the hook.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`echo \"feature/demo ISSUE-123\" > .git/jira\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`git commit -m \"Test\" --allow-empty\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`# the message is now prepended with the issue id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`# [ISSUE-123] Test\n`})]})}),`\n`,(0,e.jsxs)(n.h2,{id:\"globalize-the-hook\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#globalize-the-hook\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Globalize the hook\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"If you have many projects and you don\\u2019t want to create prepare-commit-msg file over and over again for each project, you can make it become a global hook. [Matt Venables](Matt Venables) wrote a great post about this. Please check it out at \",(0,e.jsx)(n.a,{href:\"https://coderwall.com/p/jp7d5q/create-a-global-git-commit-hook\",children:\"https://coderwall.com/p/jp7d5q/create-a-global-git-commit-hook\"})]}),`\n`,(0,e.jsxs)(n.h2,{id:\"alias-mapping-steps\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#alias-mapping-steps\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Alias mapping steps\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"As you can see even the hook becomes global, we still have to do the last step manually to map the issue id to the working branch. We can improve this by wrapping all the steps inside a single function and alias it so that we just need to call something like \",(0,e.jsx)(n.code,{children:\"jira ISSUE-123\"}),\" to set up everything.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Open \",(0,e.jsx)(n.code,{children:\"~/.bashrc\"}),\" file and add the following code:\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`map_jira_id () {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  [ ! -d .git ] && return 1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  [ ! -f .git/jira ] && touch .git/jira\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  BRANCH=$(git rev-parse --abbrev-ref HEAD)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  MATCH=$(echo \"$BRANCH\" | sed 's/\\\\//\\\\\\\\\\\\//g')\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  ISSUES=$(sed \"/^$MATCH /d\" .git/jira)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  ISSUES=\"$BRANCH $1\\\\n$ISSUES\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  echo \"$ISSUES\" > .git/jira\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`alias jira=\"map_jira_id\"\n`})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Save it and source \",(0,e.jsx)(n.code,{children:\"~/.bashrc\"}),\" to apply the change\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"test\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",tabIndex:\"-1\",href:\"#test\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Test\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now that we have created a global hook and a function alias. It\\u2019s time to test on another project.\"}),`\n`,(0,e.jsx)(n.p,{children:\"From the project folder, populate hook templates (according to Matt\\u2019s post)\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`git init\n`})})}),`\n`,(0,e.jsx)(n.p,{children:\"Test if the hook work properly\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`/project2(master)$ git checkout feature/foo\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/project2(feature/foo)$ jira ABC-123\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/project2(feature/foo)$ git commit -m \"Test\" --allow-empty\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`# [ABC-123] Test\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/project2(feature/foo)$ git checkout feature/bar\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/project2(feature/bar)$ jira ABC-456\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`/project2(feature/bar)$ git commit -m \"Test\" --allow-empty\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`# [ABC-456] Test\n`})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Hope this helps!\"})]})}}var w=j;return S;})();\n;return Component;","toc":[{"value":"Problem","url":"#problem","depth":2},{"value":"Quick start","url":"#quick-start","depth":2},{"value":"Globalize the hook","url":"#globalize-the-hook","depth":2},{"value":"Alias mapping steps","url":"#alias-mapping-steps","depth":2},{"value":"Test","url":"#test","depth":2}],"frontMatter":{"readingTime":{"text":"4 min read","minutes":3.095,"time":185700,"words":619},"slug":"git-hook-auto-prefix","fileName":"2019-03-09-git-hook-auto-prefix.md","title":"Automatically prefix commit message with Git hook","authors":["cat"],"date":"2019-03-09T00:00:00.000Z","tags":["engineering","git"],"summary":"In order to find all the commits relating to a specific JIRA issue as well as find the issue relating to a specific commit quickly, my team applies a common pattern for all commit message in our projects: `[ISSUE] MESSAGE`"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.175,"time":10500,"words":35},"slug":["cat"],"fileName":"cat.md","name":"Cat Vu","avatar":"/static/fossil.png","occupation":"Backend Engineer","company":"Fossil Vietnam","email":".","twitter":"https://twitter.com/","linkedin":"https://www.linkedin.com/in/","github":"https://github.com/","date":null}],"prev":null,"next":{"title":"Giảm kích thước Docker image cho ứng dụng Ruby on Rails","date":"2020-01-04T00:00:00.000Z","authors":["loi"],"tags":["engineering"],"summary":"Việc giảm dung lượng Docker image tuân theo nguyên tắc cơ bản nhất chính là loại bỏ các thành phần không cần thiết trong Docker image","slug":"docker-size"}},"__N_SSG":true}